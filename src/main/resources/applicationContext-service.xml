<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

  <!--扫描服务组件-->
  <context:component-scan base-package="com.medical.service"/>

  <!--aop的配置-->

  <!-- 配置SecurityManager -->
  <!--class 写错成 DefaultSecurityManager 导致BeanInitializationException: The security manager does not implement the WebSecurityManager interface.-->
  <bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">
    <property name="cacheManager" ref="cacheManager" />
    <property name="authenticator" ref="authenticator" />
    <!-- Single realm app.  If you have multiple realms, use the 'realms' property instead. -->
    <property name="realms">
      <list>
        <ref bean="userRealm"/>
        <ref bean="workerRealm"/>
        <ref bean="adminRealm"/>
      </list>
    </property>
  </bean>

  <!-- 配置CacheManager -->
  <bean id="cacheManager" class="org.apache.shiro.cache.ehcache.EhCacheManager">
    <property name="cacheManagerConfigFile" value="classpath:ehcache.xml" />
  </bean>

  <!-- 配置realm -->
  <!-- Define the realm you want to use to connect to your back-end security datasource: -->
  <bean id="userRealm" class="com.medical.shiro.realm.UserRealm">
    <!-- 配置密码匹配器 -->
    <property name="credentialsMatcher">
      <bean class="org.apache.shiro.authc.credential.HashedCredentialsMatcher">
        <!-- 加密算法为MD5 -->
        <property name="hashAlgorithmName" value="MD5"></property>
        <!-- 加密次数 -->
        <property name="hashIterations" value="1024"></property>
      </bean>
    </property>
  </bean>
  <bean id="workerRealm" class="com.medical.shiro.realm.WorkerRealm">
    <!-- 配置密码匹配器 -->
    <property name="credentialsMatcher">
      <bean class="org.apache.shiro.authc.credential.HashedCredentialsMatcher">
        <!-- 加密算法为MD5 -->
        <property name="hashAlgorithmName" value="MD5"></property>
        <!-- 加密次数 -->
        <property name="hashIterations" value="1024"></property>
      </bean>
    </property>
  </bean>
  <bean id="adminRealm" class="com.medical.shiro.realm.AdminRealm">
  <!-- 配置密码匹配器 -->
  <property name="credentialsMatcher">
    <bean class="org.apache.shiro.authc.credential.HashedCredentialsMatcher">
      <!-- 加密算法为MD5 -->
      <property name="hashAlgorithmName" value="MD5"></property>
      <!-- 加密次数 -->
      <property name="hashIterations" value="1024"></property>
    </bean>
  </property>
  </bean>

  <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">
    <property name="securityManager" ref="securityManager"/>
  </bean>

  <!-- 实现多Realm认证 -->
  <bean id="authenticator" class="com.medical.shiro.realm.CustomizedRealmAuthenticator">
    <property name="authenticationStrategy">
      <bean class="org.apache.shiro.authc.pam.AtLeastOneSuccessfulStrategy"/>
    </property>
  </bean>

</beans>
